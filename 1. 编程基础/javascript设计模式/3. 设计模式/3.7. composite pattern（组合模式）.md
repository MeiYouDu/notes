# 定义



# 实现

下面是一个组合模式的实现，通过组合模式来维护文件夹和文件之间的关系

```typescript
// 组合模式用来描述对象的部分-整体层次结构，能够很好的描述一个树结构、利用多态性统一的对待组合对象和当个对象。

abstract class Base {
  public abstract parent: Base | undefined;
  public abstract files: Array<Base> | undefined;
  /**
   * 增加文件
   */
  public abstract add(file: Base): Base;
  /**
   * 删除文件
   */
  public abstract remove(): Base;
  /**
   * 扫描文件
   */
  public abstract scan(): void;

  public abstract setParent(P: Base): Base;
}
class Folder extends Base {
  constructor(public name: string) {
    super();
  }
  public parent: Base | undefined;
  public files: Array<Base> = [];

  public add(file: Base): Folder {
    this.files.push(file);
    file.setParent(this);
    return this;
  }

  public remove(): Folder {
    const i = this.parent?.files?.findIndex((val) => {
      return val === this;
    });
    if (!i) return this;
    if (i !== -1) {
      this.parent?.files?.splice(i, 1);
      this.files.length = 0;
    }
    return this;
  }

  public scan(): void {
    this.files.forEach((file) => {
      file.scan();
    });
  }
  public setParent(P: Base): Folder {
    this.parent = P;
    return this;
  }
}

class FileCustom extends Base {
  constructor(public name: string) {
    super();
  }
  public parent: Base | undefined;
  public files = undefined;

  public add(): FileCustom {
    throw new Error("can not add file in to a file");
  }

  public remove(): FileCustom {
    const i = this.parent?.files?.findIndex((val) => {
      return val === this;
    });
    if (!i) return this;
    if (i !== -1) {
      this.parent?.files?.splice(i, 1);
    }
    return this;
  }

  public scan(): void {
    console.log(this.name);
  }

  public setParent(P: Base): FileCustom {
    this.parent = P;
    return this;
  }
}

const doc = new Folder("document");
const notes = new Folder("notes");
const dev = new Folder("dev");

doc.add(notes);
doc.add(dev);

dev.add(new FileCustom("javascript"));

notes.add(new FileCustom("math.md"));
notes.add(new FileCustom("设计模式"));

doc.scan();

dev.remove();

doc.scan();

```

