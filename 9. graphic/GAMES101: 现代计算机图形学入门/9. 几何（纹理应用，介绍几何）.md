# applications of textures

在纹理映射章节中，我们知道了==纹理可以影响着色的效果==。但除了这个作用之外纹理还有很多其他的应用。

在现代 gpu 中，==纹理=内存+对内存范围查询（过滤）==，常见的应用方式是把纹理携带的数据传递给片元进行计算。从这个角度考虑的话，纹理的应用场景就非常广泛了。

## Environment lighting

### 犹他茶壶

<img src="https://raw.githubusercontent.com/yqm1995/pic_bed/master/images/image-20250227124243580.png" alt="image-20250227124243580" style="width:50%;float:left" />

左图将环境光照保存在纹理中

右图是经典的犹他茶壶模型。

==这个例子体现了纹理在环境光中的应用==

### 球形环境光

<img src="https://raw.githubusercontent.com/yqm1995/pic_bed/master/images/image-20250227125243702.png" alt="image-20250227125243702" style="width:50%;float:left" />

这个例子中纹理是一个球型的图片。

<img src="https://raw.githubusercontent.com/yqm1995/pic_bed/master/images/image-20250227125715702.png" alt="image-20250227125715702" style="width:50%;float:left" />

球型的图片展开成一个平面，在图片的上下区域会被拉伸，这是因为墨卡托投影导致的。

### 立方体纹理

<img src="https://raw.githubusercontent.com/yqm1995/pic_bed/master/images/image-20250227131918264.png" alt="image-20250227131918264" style="width:50%;float:left" />

如图所示，每个矢量都沿着方向映射到立方体的一个点上。立方体纹理包含六个方形纹理。

uv 坐标和三维坐标系之间有一些规律
$$
\begin{array}{lcl}
定义当x>|y|并且 x>|z|时，当前面是右平面，右平面有以下特点，从上图就可以很轻松地看出来\\
\because (u,v)=(1,1)\\
\therefore x=y=z\\
\because (u,v)=(0,0)\\
\therefore x=-y=-z\\
\end{array}
$$

<img src="https://raw.githubusercontent.com/yqm1995/pic_bed/master/images/image-20250302161131556.png" alt="image-20250302161131556" style="width:50%;float:left" />

简单来说就是需要一些简单的计算把矢量方向投影到 uv 坐标上。

## texture can affect shading

- 纹理不只是表示颜色，它还可以保存高度和法线
- bump/normal mapping

法线贴图改变该位置高度，高度变化会导致法线的变化，法线的变化会导致光照计算的结果的变化。
所以法线贴图本质上影响的就是法线。

### 法线贴图

法线贴图作用是在不增加三角形数量情况下增加表面细节。

- 在不改变三角形的情况下修改法线
- 计算高度，根据新表面高度计算新的法线

<img src="https://raw.githubusercontent.com/yqm1995/pic_bed/master/images/image-20250302232316361.png" alt="image-20250302232316361" style="width:50%;float:left" />

如图所示，原始的 p 点经过计算得到了新的高度，该如何计算新位置的法线

==通过在 p 点求导，计算出这一点曲线的方向，得到方向之后（这个曲面的切线）旋转 90 度就可以得到新的法线方向。==

==导数是微积分中的一个重要概念，表示一个函数的变化率。它反映了一个变量的变化对另一个变量的影响。更简单地说，导数可以告诉我们函数在某一点的斜率或切线的倾斜度==

#### 平面改变法线

<img src="https://raw.githubusercontent.com/yqm1995/pic_bed/master/images/image-20250302232637285.png" alt="image-20250302232637285" style="width:50%;float:left" />

- 原始的表面法线是 $n(p)=(0,1)$
- p 点求导可以得到 $dp=c*[h(p+1)-h(p)]$
- 通过旋转 90 度然后转化成单位矩阵 $n(p)=(-dp,1).normalized()$

#### 3d中改变法线

- 原始的法线是 $n(p)=(0,0,1)$
- 在 p 点求导之后
  - $\frac{dp}{du}=c_{1}*[h(u+1)-h(u)]$
  - $\frac{dp}{dv}=c_{2}*[h(v+1)-h(v)]$
- 得到法线的向量为 $n=(-dp/du,-dp/dv,1)$

$$
\begin{array}{lcl}
下面是详细的推导过程\\
uv变化的时候会导致高度的变化\\
假设 u 变化了 1 个单位，v 变化0个单位，则可以得到[1,0,\frac{dp}{du}]\\
同理当 v 变化的以后可以得到[0,1,\frac{dp}{dv}]\\
这个时候我们就得到了两条切线，这两条切线必然可以得到一个切面，那么求出切面的法线就可以得到我们想要的最终结果\\
所以叉乘一下就可以得到 (-dp/du,-dp/dv,1)
\end{array}
$$



## Store microgeometry



## Procedural textures

## Solid modeling

## Volume rendering

# Introduction to geometry

