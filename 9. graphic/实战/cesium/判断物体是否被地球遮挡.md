# 描述

这个问题是地形遮蔽问题的延伸，cesium 中因为地形遮蔽导致所有几何体都会被遮蔽，但是我们并不希望文字，标签等图形被遮蔽，如果使用`disableDepthTestDistance`这个属性又会导致透视地球背面的问题。所以自然就会想，能否做到在地球背面的时候开启地形遮蔽。

# 推理

假设物体为 A，球心为 O，观察者所在位置为 P，$\angle{AOP}$如果等于 $90\degree$，如果 A 在球体表面，则这个时候$\vec{PA}$将于球体相切。如果$\angle{AOP}<90\degree$，则$\angle{AOP}$可能穿过球体表面，如果$\angle{AOP}>90\degree$则永远不可能与球体表面相交，A 不在球体表面时同理。

经过上面的推理我们聚焦于$\angle{AOP}<90\degree$时，只要计算出 O 点到$\vec{PA}$的最小距离是否小于球体的半径，如果小于则表示穿过了球体表面， 也就意味着会被遮挡。

# 计算

下面计算$\angle{AOP}<90\degree$时， O 点到$\vec{PA}$的最小距离。

1. 计算$\vec{PA}$的单位向量。
2. 计算$\vec{PO}$在$\vec{PA}$的单位向量的投影向量。
3. 根据直角三角形的变长定理，计算 O 点到$\vec{PA}$的最短距离。
4. 如果这个距离小于球体的半径则表示肯定被遮挡了。

