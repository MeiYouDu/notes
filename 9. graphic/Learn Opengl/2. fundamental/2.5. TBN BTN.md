# 什么是切线空间(tangent space)

Tangent Space，其实一个坐标系，也就是原点+三个坐标轴决定的一个相对空间，我们只要搞清楚原点和三个坐标轴是什么就可以了。在Tangent Space中，坐标原点就是顶点的位置，其中z轴是该顶点本身的法线方向（N）。另外两个坐标轴就是和该点相切的两条切线。这样的切线本来有无数条，但模型一般会给定该顶点的一个tangent，==这个tangent方向一般是使用和纹理坐标方向相同的那条tangent（T）==。而另一个坐标轴的方向（B）就可以通过normal和tangent的叉乘得到。 

<img src="https://raw.githubusercontent.com/MeiYouDu/pic_bed/master/images/v2-5f2b99607cf1790cdd955149f0436ae2_1440w.webp" alt="img" style="width:80%;float:left" />

<img src="https://picx.zhimg.com/80/v2-cc97e8e2d0eff2084045cf19d61bf58b_1440w.webp?source=1def8aca" alt="img" style="width:80%;float:left" />

<img src="https://raw.githubusercontent.com/MeiYouDu/pic_bed/master/images/v2-af0f3390357b898decbb9e7a50046822_1440w.webp" alt="img" style="width:80%;float:left" />

<img src="https://pica.zhimg.com/80/v2-fc03b4d2c6628f502b3a3daf59d290d2_1440w.webp?source=1def8aca" alt="img" style="float:80%;float:left" />

​        通常我们所见的==法线纹理==是基于原法线信息构建的坐标系来构建出来的。那种偏蓝色的法线纹理其实就是存储了在每个顶点各自的Tangent Space中，法线的扰动方向。也就是说，如果一个顶点的法线方向不变，那么在它的Tangent Space中，新的normal值就是z轴方向，也就是说值为(0, 0, 1)。**但这并不是法线纹理中存储的最终值，因为一个向量每个维度的取值范围在(-1, 1)，而纹理每个通道的值范围在(0, 1)，因此我们需要做一个映射，即pixel = (normal + 1) / 2。这样，之前的法线值(0, 0, 1)实际上对应了法线纹理中RGB的值为(0.5, 0.5, 1)，而这个颜色也就是法线纹理中那大片的蓝色。**这些蓝色实际上说明顶点的大部分法线是和模型本身法线一样的，不需要改变。总结一下就是，法线纹理的RGB通道存储了在每个顶点各自的Tangent Space中的法线方向的映射值。

# 为什么要有切线空间

实际上，法线本身存储在哪个坐标系中都是可以的，例如存储在[World Space](https://zhida.zhihu.com/search?content_id=59509975&content_type=Answer&match_order=1&q=World+Space&zhida_source=entity)、或者[Object Space](https://zhida.zhihu.com/search?content_id=59509975&content_type=Answer&match_order=1&q=Object+Space&zhida_source=entity)、或者Tangent Space中。但问题是，我们并不是单纯的想要得到法线，后续的光照计算才是我们的目的。不管使用哪个坐标系，都面临着一个选择，就是**最后光照计算使用的坐标系究竟是哪个**。对于[Tangent-Space Normal Map](https://zhida.zhihu.com/search?content_id=59509975&content_type=Answer&match_order=1&q=Tangent-Space+Normal+Map&zhida_source=entity)，我们一般就是在Tangent Space里计算的，也就是说，我们需要**把viewDir、lightDir在[Vertex Shader](https://zhida.zhihu.com/search?content_id=59509975&content_type=Answer&match_order=1&q=Vertex+Shader&zhida_source=entity)中转换到Tangent Space中，然后在Fragment Shader对法线纹理采样后，直接进行光照计算**。==（实际情况中，是把扰动的过的法线变换到世界空间或者观测空间中）==

# 切线空间的推导



> 作者：Richard Pan
> 链接：https://www.zhihu.com/question/23706933/answer/161968056
> 来源：知乎
> 著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。
>
> 
>
> 作者：御风北斗
> 链接：https://www.zhihu.com/question/23706933/answer/1943798636443054580
> 来源：知乎
> 著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。

