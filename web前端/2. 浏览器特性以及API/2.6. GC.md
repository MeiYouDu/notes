# 简介

在低级语言中，如 C 语言，需要手动的进行内存管理，如使用`malloc()`和`free()`方法。相反的，JavaScript 中会在创建对象时自动的分配内存，并在不再需要这个对象时自动释放内存（垃圾回收）。这种自动的垃圾回收会给开发者一种错觉：他们不需要关心内存管理。

# 内存生命周期

无论是何种编程语言，内存生命周期都总是遵循下面这个流程：

1. 在我们需要的时候分配内存。
2. 使用分配到的内存（读，写）。
3. 当不再需要的时候释放掉这块内存。

在所有的语言中，第二部分都是显式的（开发者自行管理），第一步和最后一步在低级语言中是显式的，但是在高级语言中（比如 JavaScript）是隐式的（引擎管理）。

## JavaScript 中内存分配

### 值初始化

为了在分配内存时不影响程序，JavaScript将在值初始化声明时自动分配内存。

```javascript
const n = 123; // allocates memory for a number
const s = "azerty"; // allocates memory for a string

const o = {
  a: 1,
  b: null,
}; // allocates memory for an object and contained values

// (like object) allocates memory for the array and
// contained values
const a = [1, null, "abra"];

function f(a) {
  return a + 2;
} // allocates a function (which is a callable object)

// function expressions also allocate an object
someElement.addEventListener(
  "click",
  () => {
    someElement.style.backgroundColor = "blue";
  },
  false,
);
```

### 通过函数调用分配内存

比如一些函数的返回值是一个对象

```javascript
const d = new Date(); // allocates a Date object

const e = document.createElement("div"); // allocates a DOM element
```

比如一些函数的返回值会创建新的对象或者值

```javascript
const s = "azerty";
const s2 = s.substr(0, 3); // s2 is a new string
// Since strings are immutable values,
// JavaScript may decide to not allocate memory,
// but just store the [0, 3] range.

const a = ["ouais ouais", "nan nan"];
const a2 = ["generation", "nan nan"];
const a3 = a.concat(a2);
// new array with 4 elements being
// the concatenation of a and a2 elements.
```

